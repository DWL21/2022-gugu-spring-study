## 2022-05-13 스터디

### DI는 무엇일까?

`의존성`은 `어느 한쪽의 변경이 다른 한쪽에 영향을 줄 수 있는 관계`를 뜻하며, `변경에 대한 여파`와 관련입니다.
(그 대상은 클래스-클래스 관계가 될 수도 있고, 패키지-패키지 관계 뿐만 아니라 메서드-메서드 관계도 될 수 있습니다.)

`의존성 주입`이란 `변경의 여파`를 최소화하는 방법입니다.

A가 B에 맺는 의존이 강하게 결합되어 있는 경우, B의 변경은 A에 큰 영향을 주게 되고
이는 SRP를 위반하는 문제를 야기합니다.  이를 해결하기 위해서는 A와 B 간의 의존 관계를 약화시켜야 하는데
B를 추상화하여 A가 B의 인터페이스와 의존 관계를 형성하도록 하면 B(구현체)의 변경은 A에게 큰 영향을 주지 못하고
A는 SRP를 보장받습니다. 이러한 형태는 A가 B(구현체)를 모르기 때문에 B 인터페이스의 타입 캡슐화 또한
보장되는 이점도 있습니다. 캡슐화가 보장되기 때문에 A는 B의 구현체가 무엇이 오든 동일한 메시징을
요청할 수 있게 되고 이 덕분에 B 구현체의 변경으로부터 안정성을 보장받아 SRP를 지킬 수 있습니다.

---

### DI의 방법으로 무엇이 있을까?

위 상황에서 `의존성 주입`은 A를 생성/사용하는 `클라이언트` 측에게 B(구현체)를 주입하는 방식을 의미합니다.
의존성 주입 방식은 `생성자 주입` / `수정자 주입` / `필드 주입` 3가지가 존재합니다.

`생성자 주입`은 클래스의 생성자를 통해 의존성을 주입받는 형태로,
생성자를 이용하므로 인스턴스 필드에 final 키워드를 할당하여 불변을 보장하는 방식이 가능하고
OOP 관점에서 객체를 설계하며 사용할 수 있다는 장점이 있습니다.

`수정자 주입`은 클래스의 수정자(setter)를 통해 의존성을 주입받는 형태로,
수정자를 이용하므로 인스턴스 필드에 final 키워드를 할당할 수 없기에 불변을 보장할 수 없습니다.
그리고 수정자가 언제, 어디서, 얼마나 호출되는지 모르기 때문에 객체의 상태가 불안정해집니다.
더군다나 수정자를 통해 인스턴스 필드에 값을 넣지 않지 않고 객체를 계속 사용한다면
해당 인스턴스 필드는 Null을 유지하게 되고 이는 곧 NPE의 발생 가능성을 껴앉고 시스템이 동작함을 의미합니다.
이는 우리가 수정자(setter)의 사용을 지양해야하는 이유와 일맥상통하기 때문에,
`수정자 주입` 보다는 `생성자 주입`을 사용해야 합니다.
그럼에도 수정자를 통해 의존성을 주입해야 한다면, 런타임 시점에서 해당 객체의 의존성을 변경해야 할 필요가
있을 때 사용할 수 있겠지만, 그 이전에 과연 좋은 설계인지 고려하는 것이 좋다고 생각합니다.

`필드 주입`은 리플렉션을 통해 인스턴스 필드에 의존성을 주입하는 형태로,
리플렉션 없이 함부로 인스턴스를 만들 수 없다는 단점과
인스턴스 필드에 final 키워드 할당이 불가능하여 불변을 보장할 수 없다는 단점이 있습니다.
그럼에도 몇몇 개발자 분들은 코드가 간결해진다는 장점으로 `필드 주입`을 선호하지만,
OOP의 관점에서 코드를 설계하고 작성해나가야 하는 객체지향 개발자라면
`필드 주입` 보다 `생성자 주입`을 선호해야 한다고 감히 판단합니다.


### 스프링의 DI 주입에서 필수 여부를 어떻게 지정할까?

@Autowired 어노테이션이 설정되어 있는 상황에서 DI 되어야 하는 의존 객체가 존재하지 않으면 익셉션이 발생한다.
만일 의존 객체가 필수적으로 필요하지 않는 상황에서는 어떻게 해야 익셉션이 발생하지 않을까?
스프링에서의 @Autowired 어노테이션은 required 속성을 제공한다.
required 속성 값을 false 로 지정하면 해당 객체가 없을 때 주입하지 않도록 할 수 있다.
하지만 이 방식은 해당 메서드의 모든 의존 대상에 적용되며,
메서드에 사용되는 의존 대상 중 특정 대상만 선택하여 필수 여부를 지정하고자 한다면
Optional로 대상 타입을 감싸거나 @Nullable 어노테이션을 설정할 수 있다.
```java
// Optional 사용
void Member(Optional<MemberId> memberId, MemberName memberName);

// @Nullable 어노테이션
void Member(@Nullable MemberId memberId, MemberName memberName);
```
